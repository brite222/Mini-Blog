@model MiniBlog.Models.BlogPost

@{
    ViewData["Title"] = "Edit Post";
    int[] selectedTags = ViewBag.SelectedTags as int[] ?? Array.Empty<int>();
}
@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        <strong>Please fix the errors below.</strong>
    </div>
}

<h1>Edit Blog Post</h1>

<form asp-action="Edit"
      method="post"
      enctype="multipart/form-data"
      class="card shadow-sm p-4">

    <input type="hidden" asp-for="Id" />

    <h4 class="mb-4">Edit Blog Post</h4>

    <!-- TITLE -->
    <div class="mb-3">
        <label asp-for="Title" class="form-label fw-semibold"></label>
        <input asp-for="Title" class="form-control" />
        <span asp-validation-for="Title" class="text-danger small"></span>
    </div>

    <!-- CATEGORY -->
    <div class="mb-3">
        <label class="form-label fw-semibold">Category</label>
        <select asp-for="CategoryId" class="form-select">
            <option value="">-- Select Category --</option>
            @foreach (var cat in ViewBag.Categories)
            {
                <option value="@cat.Id">@cat.Name</option>
            }
        </select>
    </div>

    <!-- CONTENT -->
    <div class="mb-3">
        <label asp-for="Content" class="form-label fw-semibold"></label>
        <textarea asp-for="Content" rows="6" class="form-control"></textarea>
        <span asp-validation-for="Content" class="text-danger small"></span>
    </div>

    <!-- TAGS -->
    @{
        int[] selectedTags = ViewBag.SelectedTags as int[] ?? Array.Empty<int>();
    }

    @foreach (var tag in ViewBag.Tags)
    {
        var isChecked = Array.IndexOf(selectedTags, tag.Id) >= 0;

        <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   name="TagIds"
                   value="@tag.Id"
                   @(isChecked ? "checked" : "") />
            <label class="form-check-label">@tag.Name</label>
        </div>
    }



    <!-- IMAGE -->
    <div class="mb-3">
        <label class="form-label fw-semibold">Featured Image</label>
        <input type="file" name="ImageFile" class="form-control" />
    </div>

    <!-- CURRENT IMAGE -->
    @if (!string.IsNullOrEmpty(Model.ImageUrl))
    {
        <div class="mb-3">
            <label class="form-label fw-semibold">Current Image</label><br />
            <img src="@Model.ImageUrl"
                 class="img-thumbnail"
                 style="max-height:200px" />
        </div>
    }

    <!-- ACTIONS -->
    <div class="d-flex justify-content-between mt-4">
        <a asp-action="Index" class="btn btn-outline-secondary">
            Cancel
        </a>

        <button type="submit" class="btn btn-primary px-4">
            Save Changes
        </button>
    </div>
</form>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
